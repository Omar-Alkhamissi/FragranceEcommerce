import{Q as P}from"./QInput-6U_gvg7R.js";import{Q as A}from"./QBtn-BLIJo6Ko.js";import{O as v,q as y,x as c,t as B,v as F,P as N,ah as $,y as E,r as S,f as T}from"./index-DtxRvXjt.js";import{_}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./use-key-composition-D43CFDni.js";import"./focus-manager-C3BA9bjt.js";const j={name:"BranchePage",setup(){const p=S(null);let e=T({status:"",address:"T5A-0A3",showmap:!1});const u=async()=>{try{e.status="Finding branches...",e.showmap=!0;const t=window.tt;let r=`https://api.tomtom.com/search/2/geocode/${encodeURIComponent(e.address)}.json?key=Hyxyimv7jPnUdwKFnzcAcAcjaUQEWPzB&countrySet=CA&limit=1`,l=await(await fetch(r)).json();if(!l.results||l.results.length===0){e.status="Address not found";return}let m=parseFloat(l.results[0].position.lat),h=parseFloat(l.results[0].position.lon),x=`/api/Branch/${m}/${h}`,i=await fetch(x,{method:"GET",headers:{"Content-Type":"application/json",...o()}});if(!i.ok)throw new Error(`Branch API error: ${i.status} - ${i.statusText}`);let f=await i.text(),n;try{n=JSON.parse(f)}catch(s){throw console.error("JSON parse error:",s),new Error(`Invalid JSON response: ${f}`)}if(!n||n.length===0){e.status="No branches found";return}let d=t.map({key:"Hyxyimv7jPnUdwKFnzcAcAcjaUQEWPzB",container:p.value,source:"vector/1/basic-main",center:[h,m],zoom:8});d.addControl(new t.FullscreenControl),d.addControl(new t.NavigationControl);const w=new t.LngLatBounds;n.forEach(s=>{w.extend([s.longitude,s.latitude]);let C=new t.Marker().setLngLat([s.longitude,s.latitude]).addTo(d),k=25,g=new t.Popup({offset:k});g.setHTML(`<div id="popup">Branch# ${s.id}</div><div>${s.street}, ${s.city}<br/>${s.distance.toFixed(2)} km</div>`),C.setPopup(g)}),d.fitBounds(w,{padding:50,maxZoom:12}),e.status=`Found ${n.length} closest branches`}catch(t){console.error("Branch finding error:",t),e.status=`Error: ${t.message}`}},o=()=>{const t=new Headers;t.append("Content-Type","application/json");const r=sessionStorage.getItem("customer");if(r)try{const a=JSON.parse(r);a?.token&&t.append("Authorization","Bearer "+a.token)}catch{}return t};return{mapRef:p,state:e,findClosestBranches:u}}},U={class:"text-center q-mt-md"},b={style:{height:"50vh",width:"90vw","margin-left":"5vw",border:"solid"},ref:"mapRef"},z={key:0,class:"status q-mt-md text-subtitle2 text-negative"};function H(p,e,u,o,t,r){return y(),v("div",U,[e[2]||(e[2]=c("div",{class:"text-h4"},"Find 3 Closest Branches To:",-1)),c("div",null,[B(P,{class:"q-ma-lg text-h5",placeholder:"enter current address",id:"address",modelValue:o.state.address,"onUpdate:modelValue":e[0]||(e[0]=a=>o.state.address=a)},null,8,["modelValue"]),e[1]||(e[1]=c("br",null,null,-1))]),B(A,{label:"FIND 3",onClick:o.findClosestBranches,class:"q-mb-md",style:{width:"30vw"}},null,8,["onClick"]),F(c("div",b,null,512),[[$,o.state.showmap===!0]]),o.state.status?(y(),v("div",z,E(o.state.status),1)):N("",!0)])}const L=_(j,[["render",H]]);export{L as default};
