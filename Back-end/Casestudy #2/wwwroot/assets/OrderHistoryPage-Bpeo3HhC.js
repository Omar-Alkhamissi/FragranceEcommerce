import{Q as w,d as T}from"./QBtn-fhb5mI2w.js";import{Q as q,a as f}from"./QCardSection-CXYVKXgY.js";import{Q as S,f as p}from"./apiutil-3NJE9pW-.js";import{Q as C,f as b,a as v}from"./formatutils-BftpITFC.js";import{C as Q}from"./ClosePopup-Gj_4w9WR.js";import{_ as E}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{O as u,q as h,x as t,t as n,y as l,Q as D,R as O,s as c,v as I,f as N,z as k,a2 as A}from"./index-Cd5M0Izq.js";import"./focus-manager-V_t-QWar.js";import"./focusout-DihS3Q9b.js";const B=i=>{const e=new Date(Date.parse(i)),x=e.getFullYear(),s=(e.getMonth()+1).toString().padStart(2,"0"),_=e.getDate().toString().padStart(2,"0");return`${x}-${s}-${_}`},m=i=>Math.round((parseFloat(i)||0)*100)/100,F={name:"OrderHistoryPage",setup(){const e=N({status:"",orders:[],orderSelected:!1,selectedOrderId:0,selectedOrderDate:"",orderDetails:[],orderTotals:{subTotal:0,tax:0,total:0}}),x=r=>{const o=parseFloat(r.qtyOrdered)||0,d=parseFloat(r.sellingPrice)||0,g=m(o*d);return b(g)},s=r=>{const o=Number(r.qtyOrdered)||0,d=Number(r.sellingPrice)||0;return m(o*d)},_=()=>{let r=0;e.orderDetails.forEach(g=>{r+=s(g)}),r=m(r);const o=m(r*.13),d=m(r+o);e.orderTotals={subTotal:r,tax:o,total:d}},y=async()=>{e.status="Loading orders...";try{const r=JSON.parse(sessionStorage.getItem("customer")),o=await p(`order/${r.email}`);o?.error?e.status=o.error:(e.orders=o||[],e.status=`loaded ${e.orders.length} orders`)}catch(r){console.error(r),e.status="Could not load orders"}},a=async r=>{e.selectedOrderId=r,e.status="Loading order details...";try{const o=JSON.parse(sessionStorage.getItem("customer")),d=await p(`order/${r}/${o.email}`);if(d?.error){e.status=d.error;return}e.orderDetails=d||[],e.orderDetails.length>0&&(e.selectedOrderDate=v(e.orderDetails[0].dateCreated)),_(),e.orderSelected=!0,e.status=""}catch(o){console.error(o),e.status="Failed to load order details"}};return k(y),{state:e,selectOrder:a,formatDate:B,formatCurrency:b,calculateExtended:x}}},P={class:"text-center"},V={class:"text-h6 text-negative q-mt-sm"},L={class:"q-mt-lg q-mx-md"},z={class:"full-width order-table"},H=["onClick"],M={class:"text-center"},R={class:"text-center"},X={class:"text-center"},J={class:"text-h5 text-primary text-weight-bold"},U={class:"text-body2 q-mt-xs"},Y={class:"full-width details-table"},j={class:"text-left"},G={class:"text-center"},K={class:"text-center"},W={class:"text-center"},Z={class:"text-right"},$={class:"full-width totals-table"},tt={class:"text-right"},et={class:"text-right"},st={class:"text-right text-primary text-weight-bold"},rt={class:"text-caption text-positive text-weight-bold"};function at(i,e,x,s,_,y){return h(),u("div",P,[e[6]||(e[6]=t("div",{class:"text-h4 q-mt-md text-primary"},"Order History",-1)),t("div",V,l(s.state.status),1),t("div",L,[t("table",z,[e[1]||(e[1]=t("thead",null,[t("tr",{class:"table-header"},[t("th",{class:"text-center"},"#"),t("th",{class:"text-center"},"Date"),t("th",{class:"text-center"},"Total")])],-1)),t("tbody",null,[(h(!0),u(D,null,O(s.state.orders,(a,r)=>(h(),u("tr",{key:a.id,class:A(["table-row cursor-pointer",{"even-row":r%2===0}]),onClick:o=>s.selectOrder(a.id)},[t("td",M,l(a.id),1),t("td",R,l(s.formatDate(a.orderDate)),1),t("td",X,l(s.formatCurrency(a.orderAmount)),1)],10,H))),128))])])]),n(C,{modelValue:s.state.orderSelected,"onUpdate:modelValue":e[0]||(e[0]=a=>s.state.orderSelected=a),"transition-show":"rotate","transition-hide":"rotate"},{default:c(()=>[n(S,{style:{"min-width":"350px"}},{default:c(()=>[n(q,{align:"right"},{default:c(()=>[I(n(w,{flat:"",label:"X",color:"primary",class:"text-h5"},null,512),[[Q]])]),_:1}),n(f,{class:"text-center"},{default:c(()=>[t("div",J," Order #"+l(s.state.selectedOrderId),1),t("div",U,l(s.state.selectedOrderDate),1),n(T,{name:"shopping_cart",size:"56px",color:"primary"})]),_:1}),n(f,{class:"q-pt-none"},{default:c(()=>[t("table",Y,[e[2]||(e[2]=t("thead",null,[t("tr",{class:"details-header"},[t("th",{class:"text-left"},"Name"),t("th",{class:"text-center",colspan:"3"},"Quantities"),t("th",{class:"text-right"},"Extended")]),t("tr",{class:"sub-header"},[t("th"),t("th",{class:"text-center"},"S"),t("th",{class:"text-center"},"O"),t("th",{class:"text-center"},"B"),t("th")])],-1)),t("tbody",null,[(h(!0),u(D,null,O(s.state.orderDetails,a=>(h(),u("tr",{key:a.productId,class:"details-row"},[t("td",j,l(a.productName),1),t("td",G,l(a.qtySold),1),t("td",K,l(a.qtyOrdered),1),t("td",W,l(a.qtyBackOrdered),1),t("td",Z,l(s.calculateExtended(a)),1)]))),128))])])]),_:1}),n(f,{class:"q-pa-sm q-pt-md"},{default:c(()=>[t("table",$,[t("tbody",null,[t("tr",null,[e[3]||(e[3]=t("td",{class:"text-right text-weight-bold"},"Sub:",-1)),t("td",tt,l(s.formatCurrency(s.state.orderTotals.subTotal)),1)]),t("tr",null,[e[4]||(e[4]=t("td",{class:"text-right text-weight-bold"},"Tax(13%):",-1)),t("td",et,l(s.formatCurrency(s.state.orderTotals.tax)),1)]),t("tr",null,[e[5]||(e[5]=t("td",{class:"text-right text-weight-bold"},"Total:",-1)),t("td",st,l(s.formatCurrency(s.state.orderTotals.total)),1)])])])]),_:1}),n(f,{class:"text-center q-pt-sm"},{default:c(()=>[t("div",rt," Details for order "+l(s.state.selectedOrderId),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const xt=E(F,[["render",at],["__scopeId","data-v-d86822ed"]]);export{xt as default};
