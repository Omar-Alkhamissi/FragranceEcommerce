import{Q as q,d as w}from"./QBtn-C6Lwk28j.js";import{Q as O,a as n}from"./QCardSection-tOj02MCz.js";import{Q as D,f as y}from"./apiutil-Ch0Mn9yS.js";import{Q as S,f as h,a as T}from"./formatutils-BdqLfeWk.js";import{C}from"./ClosePopup-CyvTWY9j.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{O as x,q as m,x as e,aa as k,t as l,y as d,Q as g,R as b,s as i,v as N,f as E,z as A,ab as I}from"./index-CgRy_TmJ.js";import"./focus-manager-BXrM2VB3.js";import"./focusout-IPup2kyS.js";const B=v=>{const t=new Date(Date.parse(v)),f=t.getFullYear(),s=(t.getMonth()+1).toString().padStart(2,"0"),u=t.getDate().toString().padStart(2,"0");return`${f}-${s}-${u}`},M={name:"OrderHistoryPage",setup(){const t=E({status:"",orders:[],orderSelected:!1,selectedOrderId:0,selectedOrderDate:"",orderDetails:[],orderTotals:{subTotal:0,tax:0,total:0}}),f=o=>{const a=parseFloat(o.qtyOrdered)||0,c=parseFloat(o.sellingPrice)||0,_=a*c;return h(_)},s=o=>{const a=Number(o.qtyOrdered)||0,c=Number(o.sellingPrice)||0;return Math.round(a*c*100)/100},u=()=>{let o=0;t.orderDetails.forEach(_=>{o+=s(_)}),o=Math.round(o*100)/100;const a=Math.round(o*.13*100)/100,c=Math.round((o+a)*100)/100;t.orderTotals={subTotal:o,tax:a,total:c}},p=async()=>{t.status="Loading orders...";try{const o=JSON.parse(sessionStorage.getItem("customer")),a=await y(`order/${o.email}`);a?.error?t.status=a.error:(t.orders=a||[],t.status=`loaded ${t.orders.length} orders`)}catch(o){console.error(o),t.status="Could not load orders"}},r=async o=>{t.selectedOrderId=o,t.status="Loading order details...";try{const a=JSON.parse(sessionStorage.getItem("customer")),c=await y(`order/${o}/${a.email}`);if(c?.error){t.status=c.error;return}t.orderDetails=c||[],t.orderDetails.length>0&&(t.selectedOrderDate=T(t.orderDetails[0].dateCreated)),u(),t.orderSelected=!0,t.status=""}catch(a){console.error(a),t.status="Failed to load order details"}};return A(p),{state:t,selectOrder:r,formatDate:B,formatCurrency:h,calculateExtended:f}}},V={class:"text-center"},F={class:"text-h6 text-negative q-mt-sm"},P={class:"q-mx-md",style:{border:"1px solid #dee2e6","border-top":"none"}},j=["onClick"],L={class:"col-2 text-center"},z={class:"col-6 text-center"},H={class:"col-4 text-center"},R={class:"text-h5 text-primary text-weight-bold"},X={class:"text-body2 q-mt-xs"},J={class:"row q-pa-sm items-center",style:{"border-bottom":"1px solid #f0f0f0"}},U={class:"col-4 text-left"},Y={class:"col-2 text-center"},G={class:"col-2 text-center"},K={class:"col-2 text-center"},W={class:"col-2 text-right"},Z={class:"row justify-end"},$={class:"col-12 row justify-end items-center q-py-xs"},tt={class:"col-4 text-right"},et={class:"col-12 row justify-end items-center q-py-xs"},st={class:"col-4 text-right"},ot={class:"col-12 row justify-end items-center q-py-xs"},rt={class:"col-4 text-right text-primary text-weight-bold"},at={class:"text-caption text-positive text-weight-bold"};function dt(v,t,f,s,u,p){return m(),x("div",V,[t[5]||(t[5]=e("div",{class:"text-h4 q-mt-md text-primary"},"Order History",-1)),e("div",F,d(s.state.status),1),t[6]||(t[6]=k('<div class="q-mt-lg q-mx-md"><div class="row text-weight-bold text-primary q-pa-sm" style="background-color:#f8f9fa;border-bottom:2px solid #dee2e6;"><div class="col-2 text-center">#</div><div class="col-6 text-center">Date</div><div class="col-4 text-center">Total</div></div></div>',1)),e("div",P,[(m(!0),x(g,null,b(s.state.orders,(r,o)=>(m(),x("div",{key:r.id,class:"row items-center cursor-pointer q-pa-sm",style:I(["border-bottom:1px solid #dee2e6;",o%2===0?"background-color:#ffffff;":"background-color:#f8f9fa;"]),onClick:a=>s.selectOrder(r.id)},[e("div",L,d(r.id),1),e("div",z,d(s.formatDate(r.orderDate)),1),e("div",H,d(s.formatCurrency(r.orderAmount)),1)],12,j))),128))]),l(S,{modelValue:s.state.orderSelected,"onUpdate:modelValue":t[0]||(t[0]=r=>s.state.orderSelected=r),"transition-show":"rotate","transition-hide":"rotate"},{default:i(()=>[l(D,{style:{"min-width":"350px"}},{default:i(()=>[l(O,{align:"right"},{default:i(()=>[N(l(q,{flat:"",label:"X",color:"primary",class:"text-h5"},null,512),[[C]])]),_:1}),l(n,{class:"text-center"},{default:i(()=>[e("div",R," Order #"+d(s.state.selectedOrderId),1),e("div",X,d(s.state.selectedOrderDate),1),l(w,{name:"shopping_cart",size:"56px",color:"primary"})]),_:1}),l(n,{class:"q-pt-none"},{default:i(()=>t[1]||(t[1]=[e("div",{class:"row text-weight-bold text-primary q-px-sm q-py-xs",style:{"border-bottom":"2px solid #e6e6e6"}},[e("div",{class:"col-4 text-left"},"Name"),e("div",{class:"col-2 text-center"},"Quantities"),e("div",{class:"col-2"}),e("div",{class:"col-2"}),e("div",{class:"col-2 text-right"},"Extended")],-1),e("div",{class:"row q-pa-xs text-caption text-primary",style:{"background-color":"#f0f0f0","border-bottom":"1px solid #dee2e6"}},[e("div",{class:"col-4"}),e("div",{class:"col-2 text-center"},"S"),e("div",{class:"col-2 text-center"},"O"),e("div",{class:"col-2 text-center"},"B"),e("div",{class:"col-2"})],-1)])),_:1,__:[1]}),l(n,{class:"q-pa-none"},{default:i(()=>[(m(!0),x(g,null,b(s.state.orderDetails,r=>(m(),x("div",{key:r.productId},[e("div",J,[e("div",U,d(r.productName),1),e("div",Y,d(r.qtySold),1),e("div",G,d(r.qtyOrdered),1),e("div",K,d(r.qtyBackOrdered),1),e("div",W,d(s.calculateExtended(r)),1)])]))),128))]),_:1}),l(n,{class:"q-pa-sm q-pt-md"},{default:i(()=>[e("div",Z,[e("div",$,[t[2]||(t[2]=e("div",{class:"col-4 text-right text-weight-bold"},"Sub:",-1)),e("div",tt,d(s.formatCurrency(s.state.orderTotals.subTotal)),1)]),e("div",et,[t[3]||(t[3]=e("div",{class:"col-4 text-right text-weight-bold"},"Tax(13%):",-1)),e("div",st,d(s.formatCurrency(s.state.orderTotals.tax)),1)]),e("div",ot,[t[4]||(t[4]=e("div",{class:"col-4 text-right text-weight-bold"},"Total:",-1)),e("div",rt,d(s.formatCurrency(s.state.orderTotals.total)),1)])])]),_:1}),l(n,{class:"text-center q-pt-sm"},{default:i(()=>[e("div",at," Details for order "+d(s.state.selectedOrderId),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const _t=Q(M,[["render",dt]]);export{_t as default};
