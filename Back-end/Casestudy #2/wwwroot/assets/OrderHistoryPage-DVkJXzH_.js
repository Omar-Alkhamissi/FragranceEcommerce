import{Q as q,d as w}from"./QBtn-CCl3ETPk.js";import{Q as O,a as n}from"./QCardSection-B5HmoH7I.js";import{Q as D,f as y}from"./apiutil-pitb0OOP.js";import{Q as S,f as h}from"./formatutils-Cyr892w5.js";import{C as T}from"./ClosePopup-CGoHlqXe.js";import{_ as C}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{O as x,q as m,x as e,aa as Q,t as l,y as d,Q as g,R as b,s as i,v as k,f as N,z as E,ab as A}from"./index-CBEMdLdY.js";import"./focus-manager-Beo8uyHd.js";import"./focusout-FeijJFDn.js";const I=v=>{const t=new Date(Date.parse(v)),f=t.getFullYear(),s=(t.getMonth()+1).toString().padStart(2,"0"),u=t.getDate().toString().padStart(2,"0");return`${f}-${s}-${u}`},B={name:"OrderHistoryPage",setup(){const t=N({status:"",orders:[],orderSelected:!1,selectedOrderId:0,selectedOrderDate:"",orderDetails:[],orderTotals:{subTotal:0,tax:0,total:0}}),f=o=>{const a=parseFloat(o.qtyOrdered)||0,c=parseFloat(o.sellingPrice)||0,_=a*c;return h(_)},s=o=>{const a=Number(o.qtyOrdered)||0,c=Number(o.sellingPrice)||0;return Math.round(a*c*100)/100},u=()=>{let o=0;t.orderDetails.forEach(_=>{o+=s(_)}),o=Math.round(o*100)/100;const a=Math.round(o*.13*100)/100,c=Math.round((o+a)*100)/100;t.orderTotals={subTotal:o,tax:a,total:c}},p=async()=>{t.status="Loading orders...";try{const o=JSON.parse(sessionStorage.getItem("customer")),a=await y(`order/${o.email}`);a?.error?t.status=a.error:(t.orders=a||[],t.status=`loaded ${t.orders.length} orders`)}catch(o){console.error(o),t.status="Could not load orders"}},r=async o=>{t.selectedOrderId=o,t.status="Loading order details...";try{const a=JSON.parse(sessionStorage.getItem("customer")),c=await y(`order/${o}/${a.email}`);if(c?.error){t.status=c.error;return}t.orderDetails=c||[],t.orderDetails.length>0&&(t.selectedOrderDate=t.orderDetails[0].dateCreated),u(),t.orderSelected=!0,t.status=""}catch(a){console.error(a),t.status="Failed to load order details"}};return E(p),{state:t,selectOrder:r,formatDate:I,formatCurrency:h,calculateExtended:f}}},M={class:"text-center"},V={class:"text-h6 text-negative q-mt-sm"},F={class:"q-mx-md",style:{border:"1px solid #dee2e6","border-top":"none"}},P=["onClick"],j={class:"col-2 text-center"},z={class:"col-6 text-center"},H={class:"col-4 text-center"},L={class:"text-h5 text-primary text-weight-bold"},R={class:"text-body2 q-mt-xs"},X={class:"row q-pa-sm items-center",style:{"border-bottom":"1px solid #f0f0f0"}},J={class:"col-4 text-left"},U={class:"col-2 text-center"},Y={class:"col-2 text-center"},G={class:"col-2 text-center"},K={class:"col-2 text-right"},W={class:"row justify-end"},Z={class:"col-12 row justify-end items-center q-py-xs"},$={class:"col-4 text-right"},tt={class:"col-12 row justify-end items-center q-py-xs"},et={class:"col-4 text-right"},st={class:"col-12 row justify-end items-center q-py-xs"},ot={class:"col-4 text-right text-primary text-weight-bold"},rt={class:"text-caption text-positive text-weight-bold"};function at(v,t,f,s,u,p){return m(),x("div",M,[t[5]||(t[5]=e("div",{class:"text-h4 q-mt-md text-primary"},"Order History",-1)),e("div",V,d(s.state.status),1),t[6]||(t[6]=Q('<div class="q-mt-lg q-mx-md"><div class="row text-weight-bold text-primary q-pa-sm" style="background-color:#f8f9fa;border-bottom:2px solid #dee2e6;"><div class="col-2 text-center">#</div><div class="col-6 text-center">Date</div><div class="col-4 text-center">Total</div></div></div>',1)),e("div",F,[(m(!0),x(g,null,b(s.state.orders,(r,o)=>(m(),x("div",{key:r.id,class:"row items-center cursor-pointer q-pa-sm",style:A(["border-bottom:1px solid #dee2e6;",o%2===0?"background-color:#ffffff;":"background-color:#f8f9fa;"]),onClick:a=>s.selectOrder(r.id)},[e("div",j,d(r.id),1),e("div",z,d(s.formatDate(r.orderDate)),1),e("div",H,d(s.formatCurrency(r.orderAmount)),1)],12,P))),128))]),l(S,{modelValue:s.state.orderSelected,"onUpdate:modelValue":t[0]||(t[0]=r=>s.state.orderSelected=r),"transition-show":"rotate","transition-hide":"rotate"},{default:i(()=>[l(D,{style:{"min-width":"350px"}},{default:i(()=>[l(O,{align:"right"},{default:i(()=>[k(l(q,{flat:"",label:"X",color:"primary",class:"text-h5"},null,512),[[T]])]),_:1}),l(n,{class:"text-center"},{default:i(()=>[e("div",L," Order #"+d(s.state.selectedOrderId),1),e("div",R,d(s.state.selectedOrderDate),1),l(w,{name:"shopping_cart",size:"56px",color:"primary"})]),_:1}),l(n,{class:"q-pt-none"},{default:i(()=>t[1]||(t[1]=[e("div",{class:"row text-weight-bold text-primary q-px-sm q-py-xs",style:{"border-bottom":"2px solid #e6e6e6"}},[e("div",{class:"col-4 text-left"},"Name"),e("div",{class:"col-2 text-center"},"Quantities"),e("div",{class:"col-2"}),e("div",{class:"col-2"}),e("div",{class:"col-2 text-right"},"Extended")],-1),e("div",{class:"row q-pa-xs text-caption text-primary",style:{"background-color":"#f0f0f0","border-bottom":"1px solid #dee2e6"}},[e("div",{class:"col-4"}),e("div",{class:"col-2 text-center"},"S"),e("div",{class:"col-2 text-center"},"O"),e("div",{class:"col-2 text-center"},"B"),e("div",{class:"col-2"})],-1)])),_:1,__:[1]}),l(n,{class:"q-pa-none"},{default:i(()=>[(m(!0),x(g,null,b(s.state.orderDetails,r=>(m(),x("div",{key:r.productId},[e("div",X,[e("div",J,d(r.productName),1),e("div",U,d(r.qtySold),1),e("div",Y,d(r.qtyOrdered),1),e("div",G,d(r.qtyBackOrdered),1),e("div",K,d(s.calculateExtended(r)),1)])]))),128))]),_:1}),l(n,{class:"q-pa-sm q-pt-md"},{default:i(()=>[e("div",W,[e("div",Z,[t[2]||(t[2]=e("div",{class:"col-4 text-right text-weight-bold"},"Sub:",-1)),e("div",$,d(s.formatCurrency(s.state.orderTotals.subTotal)),1)]),e("div",tt,[t[3]||(t[3]=e("div",{class:"col-4 text-right text-weight-bold"},"Tax(13%):",-1)),e("div",et,d(s.formatCurrency(s.state.orderTotals.tax)),1)]),e("div",st,[t[4]||(t[4]=e("div",{class:"col-4 text-right text-weight-bold"},"Total:",-1)),e("div",ot,d(s.formatCurrency(s.state.orderTotals.total)),1)])])]),_:1}),l(n,{class:"text-center q-pt-sm"},{default:i(()=>[e("div",rt," Details for order "+d(s.state.selectedOrderId),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const vt=C(B,[["render",at]]);export{vt as default};
